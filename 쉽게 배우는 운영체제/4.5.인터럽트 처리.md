# 4.5. 인터럽트 처리

## 인터럽트의 개념(입출력에서만)

- 과거에는 입출력장치가 거의 없었기 때문에 입출력을 요청하면 운영체제가 주기적으로 입출력장치를 직접 확인해서 처리했다. (폴링 방식)
- 오늘날에는 프로세스의 이벤트 드리븐 방식과 동일하게 입출력을 요청하고 입출력이 완료되면 이벤트(인터럽트)를 발생시켜 이 사실을 알리게 되었다.
  - 이벤트 드리븐(event driven): 버튼이 눌렸는지 안 눌렸는지 주기적으로 확인하는 대신 버튼이 눌리면 프로세스에 알려주는 것

## 종류

### 동기적 인터럽트(synchronous interrupt)

- 실행 중인 명령어로 인해 발생하는 인터럽트. === 사용자 인터럽트
- 발생 상황
  - 프로그램의 문제 때문에 발생하는 인터럽트 (예: 다른 사용자의 메모리 영역에 접근하는 경우, 오버플로나 언더플로에 의해 발생하는 경우)
  - 컴퓨터 작업자가 의도적으로 프로세스를 중단하기 위해 발생시킨 인터럽트 (예: 유닉스에서의 ctrl + c)
  - 입출력장치 같은 주변장치 조작에 의한 인터럽트
  - 산술 연산 중 발생하는 인터럽트 (예: 어떤 수를 0으로 나눔)

### 비동기적 인터럽트(asynchronous interrupt)

- 실행 중인 명령어와 무관하게 발생하는 인터럽트
- 하드디스크 읽기 오류, 메모리 불량과 같은 하드웨어 오류로 발생하는 인터럽트
- 사용자가 직접 작동하는 키보드 인터럽트, 마우스 인터럽트 등이 있다.

## 인터럽트 처리

- 인터럽트에는 해당 인터럽트 발생시 어떤 일을 할지가 정의되어 있다.
  - 인터럽트 고유 번호(IRQ)와 그 번호에 붙어있는 함수의 쌍으로 이루어짐
  - 인터럽트 발생시 시스템은 IRQ로 인터럽트를 식별한다.
- 인터럽트 여러 개가 동시에 발생할 경우 인터럽트를 하나로 묶은 인터럽트 벡터로 처리한다.
  - 인터럽트 백터는 인터럽트의 집합으로, 인터럽트와 인터럽트 핸들러를 일대일로 연결한 자료구조이다.
  - 인터럽트 백터에는 각 인터럽트를 처리하는 함수(인터럽트 핸들러, interrupt handler)가 연결되어 있다.

### 처리 과정

1. 인터럽트가 발생하면 현재 실행 중인 프로세는 일시 정지 상태가 되고, 재시작을 위한 프로세스 관련 정보를 임시 저장한다.
2. 인터럽트 컨트롤러가 실행되어 인터럽트 처리 순서를 결정한다. 여러 개의 인터럽트가 동시 발생했을 경우, 우선순위에 따라 중요한 인터럽트부터 처리하도록 순서를 결정한다.
3. 인터럽트 벡터에 등록된 인터럽트 핸들러가 실행된다.
4. 인터럽트 핸들러가 인터럽트 처리를 마치면 일시 정지된 프로세스가 다시 실행되거나 종료된다.
   - 발생한 인터럽트가 입출력 완료라면 일시 정지된 프로세스가 다시 실행되고, 다른 프로세스의 메모리 영역 침범이나 오류라면 종료된다.

## 인터럽트와 이중 모드

- 운영체제는 자원을 보호하기 위해 커널 모드와 사용자 모드로 나눈 이중 모드로 일을 처리한다.
  - 커널 모드: 운영체제와 관련된 커널 프로세스가 실행되는 모드
  - 사용자 모드: 사용자 프로세스가 실행되는 모드
- 사용자 프로세스가 시스템 자원에 직접 접근하면 문제가 발생할 수 있으므로, 커널은 시스템 호출을 통해서만 자원에 접근할 수 있도록 제한한다.
  - 사용자 프로세스는 운영체제가 제공하는 API를 이용한 시스템 호출을 통해 시스템 자원에 접근할 수 있다.

### 사용자가 커널 모드로 진입하는 경우

- 시스템 호출을 사용하는 경우: 사용자 프로세스가 원해서 진입하는 것으로, 자발적(voluntary)이다.
- 인터럽트를 발생시킨 경우: 잘못된 명령을 수행하여 동기적 인터럽트가 발생한 것으로 프로세스가 강제 종료된다. 비자발적(non-voluntary)이다.
