# 3.3 프로세스의 연산

## 프로세스의 구조

- 코드 영역(code area) === 텍스트 영(text area)
  - 프로그램의 본문이 기술된 곳
  - 개발자가 작성한 프로그램이 탑재되는 곳으로, 탑재된 코드는 읽기 전용으로 처리된다.
- 데이터 영역(data area)
  - 코드가 실행되면서 사용하는 변수나 파일 등 가종 데이터를 모아두는 곳
  - 읽기와 쓰기가 가능하나, 상수로 선언된 변수는 읽기 전용이다.
  - 일반 데이터 영역과 힙 영역으로 나뉨
- 스택 영역(stack area)
  - 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아두는 곳
  - 사용자는 볼 수 없음

## 프로세스의 생성과 복사

### 새로 생성

- 사용자가 프로그램을 실행하면 프로세스가 생성된다.
- 프로그램을 실행하면 -> 운영체제가 프로그램을 메모리로 가져와 코드 영역에 넣고 프로세스 제어 블록을 생성한다. -> 메모리에 데이터 영역과 스택 영역을 확보한 후 프로세스를 실행한다.

### 실행 중인 프로세스에서 새로운 프로세스를 복사하여 생성: fork()

- fork() 시스템 호출은 실행 중인 프로세스를 복사하여 새로운 프로세스를 생성하는 것으로, 커널에서 제공한다.
- 프로세스를 복사할 때 기존 프로세스는 부모 프로세스가 되고, 새로 생긴 프로세스는 자식 프로세스가 된다.
- 복사된 프로세스는 PID와 메모리 관련 정보, PPID, CPID가 변경된다.
- 장점
  - 프로세스의 생성 속도가 빠르다.
  - 추가 작업 없이 자원을 상속할 수 있다.
  - 시스템 관리를 효율적으로 할 수 있다
    - 자식 프로세스를 종료하면 프로세스에서 사용하던 메모리 등 정리를 부모 프로세스에게 맡긴다.

### 복사된 새로운 프로세스의 내용 교체: exec()

- 기존 프로세스를 새로운 프로세스로 전환하는 함수
- 프로세스의 구조를 재활용하기 위해 교체하는 방식을 사용한다.
  - 프로세스 구조를 생성하는 일련의 과정이 생략된다.
  - 부모-자식 관계가 유지되어 시스템 관리를 효율적으로 할 수 있다.

## 프로세스의 계층 구조

- 프로세스의 계층 구조는 동시에 여러 작업을 처리하고 종료된 프로세스의 자원을 회수하는 데 유용핟다.
  - 프로세스를 복사하여 동일한 프로세스를 여러개 만들어 동일 작업을 병렬적으로 처리할 수 있다.
  - 프로세스 간의 책임 관계가 분명하므로, 운영체제가 직접 회수하지 않고 부모 프로세스가 자원을 회수하여 유용하다.
- 부모 프로세스는 자원을 회수하기 위해 자식 프로세스가 끝날 때까지 기다려야 한다.

## 고아 프로세스와 좀비 프로세스

- 자식 프로세스가 종료되기 전 부모가 먼저 종료되면 자식 프로세스는 고아 프로세스(orphan process)가 되어 프로세스가 종료되지 않는다.
- 자식 프로세스가 종료됐는데 부모 프로세스가 뒤처리를 하지 않을 경우 좀비 프로세스(zombie process)가 되어 종료됐음에도 사용하던 자원이 그대로 남는다.
- 운영체제는 주기적으로 반환되지 못한 자원을 회수해야 한다.
- 컴퓨터를 오래 켜두면 각종 프로세스가 메모리에 상주하고, 좀비 프로세스가 메모리를 차지하기 때문에 컴퓨터가 느려진다.
