# 3.2 프로세스 제어 블록과 문맥 교환

## PCB(프로세스 제어 블록)

- 프로세스를 실행하는 데 필요한 중요한 정보를 보관하는 자료구조
- === TCB(Task Control Block)

### 구성요소

- 포인터: 큐로 운영되는 준비 상태나 대기 상태의 큐를 구현할 때 사용
- 프로세스 상태: 생성, 준비, 실행, 대기, 보류 준비, 보류 대기 등 프로세스의 현재 상태를 저장한다.
- 프로세스 구분자(PID): 운영체제 내에 있는 여러 프로세스를 구별하기 위한 구분자
- 프로그램 카운터: 다음에 실행될 명령어의 위치를 가리킨다.
- 프로세스 우선순위
  - 프로세스는 각기 다른 우선순위를 가진다.
  - 커널 프로세스 > 사용자 프로세스 (사용자 프로세스 내에서도 우선순위가 갈린다.)
  - 대기 상태를 관리하는 큐에 프로세스 제어 블록이 우선 순위에 따라 구분되어 여러 줄로 서있다.
  - CPU 스케줄러는 프로세스 우선순위가 높은 순으로 준비 상태에서 실행 상태로 옮긴다.
- 각종 레지스터 정보
  - 프로세스가 실행될 때 사용하던 레지스터의 중간값
  - 누산기(accumulator), 색인 레지스터(index registeer), 스택 포인터(stack pointer) 등
- 메모리 관련 정보
  - 메모리 위치 정보
  - 메모리 보호를 위한 경계 레지스터 값, 한계 레지스터 값
  - 세그먼테이션 테이블(segmentation table), 페이지 테이블(page table)
  - 기타
- 할당된 자원 정보
  - 프로세스를 실행하기 위해 사용하는 입출력 자원이나 오픈 파일 등에 대한 정보
  - 예: 음악을 출력하기 위해 사운드 카드에 접근하는 프로세스일 경우, 사운드 카드에 대한 정보를 저장함
- 계정 정보: 계정 번호, CPU 할당 시간, CPU 사용 시간 등
- 부모 프로세스 구분자(PPID, Parent PID)와 자식 프로세스 구분자(CPID, Child PID)

## 문맥 교환

- CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업, 즉 두 프로세스의 프로세스 제어 블록을 교환하는 작업
- 실행 상태에서 나가는 프로세스 제어 블록에는 지금까지의 작업 내용을 업데이트한다.
- CPU는 실행 상태로 들어오는 프로세스 제어 블록의 내용으로 다시 세팅된다.
- 문맥 교환은 프로세스가 타임아웃 뿐만 아니라 인터럽트가 걸릴 경우에도 발생한다.
  - 예시: 실행 상태의 프로세스가 주어진 메모리 공간을 넘어가려고 하면 경계 레지스터의 범위를 벗어난다. 이때 인터럽트가 발생하여 현재 실행 중인 프로세스의 PCB를 업데이트한 후, 인터럽트 관리 프로세스를 실행 상태로 만들고, 인터럽트 관리 프로세스는 메모리 범위를 넘어선 프로세스를 강제 종료한다.

### 타임 슬라이스 크기

- 타임 슬라이스는 되도록 작게 설정하되 문맥 교환에 걸리는 시간을 고려하여 적당한 크기를 설정해야 한다.
  - 타임 슬라이스가 너무 크면 프로세스의 작업이 끝나고도 시간이 남아 비효율적이다.
  - 타임 슬라이스가 너무 작으면 타임 슬라이스보다 문맥 교환에 더 많은 시간을 차지하게 되어 비효율적이다.
- 유닉스의 경우 대략 100 밀리초로, 타임 슬라이스를 고정하지 않고 10~200 밀리초 사이에서 조정한다.
