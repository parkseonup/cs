# 5.2. 공유 자원과 임계 구역

## 공유 자원

- 공유 자원(shared resource)이란 여러 프로세스가 공동으로 변수, 메모리, 파일 등을 말한다.
- 여러 프로세스가 공유 자원을 병행해서 읽거나 쓰는 상황이 발생할 수 있는데, 이러한 상황을 경쟁 조건(race condition)이라 한다.

## 임계 구역

- 경쟁 조건에서는 공유 자원 접근 순서에 따라 실행 결과가 달라질 수 있다. 이렇게 실행 결과가 달라질 수 있기 때문에 여러 프로세스가 동시에 접근해서는 안되는 프로그램의 영역을 임계 구역(critical section)이라 한다.
- 한 프로세스가 임계 구역에 들어가면 다른 프로세스는 임계 구역 밖에서 지정된 시간 만큼 대기해야 한다.
- 임계 구역과 관련된 전통적인 문제로는 생산자-소비자 문제가 있다.
- 임계 구역은 하드웨어 자원을 사용할 때도 적용되는 개념이다. (예시: 프린터 한 대를 여러 프로세스가 사용하는 경우)
- 임계 구역으로 지정되어야 할 코드 영역이 임계 구역으로 지정되지 않았을 경우 문제가 발생할 수 있다. 이를 임계 구역 문제라고 한다.

### 생산자-소비자 문제(producer-consumer problem)란?

- 생산자와 소비자가 한정된 크기의 버퍼를 공유하여 사용하기 때문에 발생되는 문제이다.
  - 데이터를 생산하는 쪽이 생산자, 데이터를 꺼내 쓰는 쪽이 소비자이다.
- 버퍼 크기 제한으로 인해 발생되기 때문에, 한정 버퍼 문제(bounded-buffer problem)이라고도 한다.
- 생산자가 데이터를 생산했으나 저장할 공간이 부족하거나, 소비자가 데이터를 꺼내 써야 하는데 데이터가 없는 문제이다.
  - 보통 생산 속도가 소비 속도보다 빠르기 때문에 저장 공간이 부족할 경우가 많다.
- 이를 해결하기 위해 생산 속도와 소비 속도를 동일하게 맞추는데, 이러한 행위는 경쟁 조건을 발생시키기 때문에 상호 배제 기능(프로세스 동기화)을 추가하여 오류를 수정해야 한다.

참고: [운영체제 9장 - 프로세스 관리(6) : 생산자-소비자 문제](https://copycode.tistory.com/67), [생산자-소비자 문제 - 위키백과](https://ko.wikipedia.org/wiki/%EC%83%9D%EC%82%B0%EC%9E%90-%EC%86%8C%EB%B9%84%EC%9E%90_%EB%AC%B8%EC%A0%9C)

### 임계 구역 문제 해결 조건

- 상호 배제(mutual exculsion): === 상호 배타. 한 프로세스가 임계 구역에 들어가면 다른 프로세스는 임계구역에 들어갈 수 없다.
- 한정 대기(bounded waiting): 한 프로세스만 임계 구역을 차지하여 다른 프로세스들이 무한 대기(infinite prostpone) 하지 않아야 한다.
- 진행의 융통성(progress flexibility): 임계 구역에 들어간 프로세스가 없고 들어가고자 하는 프로세스가 여러 개 있다면, 프로세스들이 무한 대기 하지 않도록 어느 것이 들어갈지를 적절히 결정해주어야 한다.

참고: [Critical Section in Synchronization - geeks](https://www.geeksforgeeks.org/g-fact-70/)
