# 27. 프로세스 상태와 계층 구조

## 프로세스 상태

### 생성 상태

- 이제 막 메모리에 적재되어 PCB를 할당 받은 상태
- 준비가 완료되었다면 준비 상태로 옮겨짐

### 준비 상태

- 당장이라도 CPU를 할당 받아 실행할 수 있지만, 자신의 실행 차례가 아니기 때문에 기다리는 상태
- 자신의 차례가 된다면 실행 상태로 옮겨진다 === 디스패치 발생.

### 실행 상태

- CPU를 할당 받아 실행 중인 상태
- 할당된 시간을 모두 사용하면(타이머 인터럽트가 발생하면) 준비 상태로 이동한다.
- 실행 도중 입출력 장치를 사용하면 입출력 작업이 끝날 때까지 대기 상태로 이동

### 대기 상태

- 프로세스가 실행 도중 입출력장치를 사용하는 경우
- 입출력 작업은 CPU에 비해 느리기 때문에 성능을 위해 대기 상태로 접어든다.
- 입출력 작업이 끝나면(입출력 완료 인터럽트가 발생할 때까지) 준비 상태로 이동함

### 종료 상태

- 프로세스가 종료된 상태
- 프로세스의 메모리 영역과 PCB가 정리됨

## 프로세스 계층 구조

- 대부분의 운영체제는 프로세스를 계층 구조로 관리하지만, 윈도우는 아니다.
- 프로세스는 실행이 되는 도중에 시스템 호출을 통해 다른 프로세스를 생성할 수 있다.
  - 새 프로세스를 생성한 프로세스: 부모 프로세스
  - 부모 프로세스에 의해 새로 생성된 프로세스: 자식 프로세스
  - 부모 프로세스와 자식 프로세스는 별개의 프로세스로, 각각 다른 PID를 가진다.
  - 일부 운영체제에서는 자식 프로세스의 PCB에 부모 프로세스의 PID(PPID)를 명시하기도 한다.
  - 자식 프로세스는 여러개 생성될 수 있으며, 자식 프로세스 또한 다른 프로세스를 생성할 수 있다.
- 컴퓨터 부팅시 최초의 프로세스가 생성되고, 시스템 호출을 통해 다른 자식 프로세스를 생성하여 계층 구조를 이룬다.

### 프로세스 생성 기법 (윈도우x)

#### fork 시스템 호출

- fork는 자기 자신 프로세스의 복사본을 자식 프로세스로 생성하는 시스템 호출이다.
- 부모 프로세스의 자원을 자식 프로세스에 상속한다.
- 이때 부모 프로세스와 자식 프로세스는 PID나 저장된 메모리 위치는 다르나, 동일한 내용을 가지므로 동일한 작업을 하는 프로그램이 여러개 생기는 것이다..

#### exec 시스템 호출

- 자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출이다.
- 코드/데이터 영역은 실행할 프로그램 내용으로 바꾸고 나머지 영역은 초기화한다.
- 자식 프로세스가 exec 시스템 호출로 자신의 메모리 공간을 다른 프로그램으로 교체하여 부모 프로세스와 다른 프로그램으로 만든다.
