# 2. 인터럽트에서 DirectX까지

## 인터럽트(Interrupt)

- 인터럽트는 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우, 현재 실행중인 작업을 중단하고 발생된 상황을 처리한 후 다시 실행중인 작업으로 복귀하는 것을 말한다.
- 인터럽트가 발생하면 성능 지연이 생긴다.

### 인터럽트의 종류

외부 인터럽트, 내부 인터럽트, 소프트웨어 인터럽트가 있다.

#### 외부 인터럽트

- 전원 이상 인터럽트(Power fail Interrupt): 정전 등 전원에 이상이 생기는 경우
- 기계 착오 인터럽트(Machine check Interrupt): CPU에 기능적인 오류가 있을 경우
- 외부 신호 인터럽트(External Interrupt)
  - 타이머에 의한 인터럽트: Preemptive 개념
  - 키보드로 인터럽트 키를 누를 경우. 대표적으로 control + alt + delete로 강제 종료
  - 외부장치로부터 인터럽트 요청이 있는 경우
- 입출력 인터럽트(I/O Interrupt)
  - 입출력장치가 데이터 전송을 요구하거나, 전송이 끝나 다음 동작이 수행되어야 할 경우
  - 입출력 데이터에 이상이 있는 경우

#### 내부 인터럽트

- 잘못된 명령이나 잘못된 데이터를 사용할 때 발생하며 Trap이라 부른다.
- 프로그램 검사 인터럽트(Program check Interrupt)
  - Division by zero: 컴퓨터는 나눗셈을 할 때 빼기를 수행하여 몫과 나머지를 구한다. 0으로 나누면 무한 루프에 빠진다.
  - Overflow/Underflow
  - 기타 Exception

### 인터럽트 동작 순서

1. 인터럽트 요청
2. 프로그램 실행 중단: 현재 실행중이던 Micro operation까지 수행한다. === CPU가 연산하던 것을 일시적으로 중단한다.
3. 현재의 프로그램 상태 보존: PCB(Process Control Block), PC(Process Counter) 등. 중단한 프로그램의 상태를 백업한다.
4. 인터럽트 처리루트 실행: 인터럽트를 요청한 장치를 식별한다.
5. 인터럽트 서비스 루틴(ISR, Interrupt Service Routine)
   - 인터럽트 처리 코드
   - 인터럽트 원인을 파악하고 실질적인 작업을 수행한다.
   - 처리기 레지스터 상태를 보존한다.
   - 서비스 루틴 수행 중 우선순위가 더 높은 인터럽트가 발생하면 또 재귀적으로 1~5를 수행한다.
6. 상태복구: 인터럽트 발생시 저장해둔 PC(Program Counter)를 다시 복구한다.
7. 중단된 프로그램 실행 재개: PC의 값을 이용하여 이전에 수행중이던 프로그램의 실행을 재개한다.

### 인터럽트 우선 순위

- 전원이상(Power fail) > 기계 착오(Machine Check) > 외부 신호(External) > 입출력(I/O) > 명령어 잘못 > 프로그램 검사(Program Check) > SVC(SuperVisor Call)
- 대부분, 하드웨어 인터럽트 > 소프트웨어 인터럽트
- 대부분, 외부 인터럽트 > 내부 인터럽트

### 메모리 매니저

- 과거에는 브릿지라고 불림
  - 노스브릿지(Northbridge): CPU, RAM 등 핵심 기기의 입출력
  - 사우스브릿지(Southbridge): 주변기기와 입출력할 때
- 현재는 CPU가 노스브릿지의 역할을 함께 함

## DirectX

- 주변 기기를 좋은 것으로 사면 CPU가 모든 처리를 하지 않고, 일부 처리를 주변 기기에게 대신 시키고 다른 일을 동시에 수행할 수 있다.
- 윈도우 XP 시절에는 커널에 GDI 엔진이 추가로 있었다. 이는 추상화를 가능하게 해서 사용자가 주변기기 컨트롤을 하지 않아도 되게끔 했지만, 제어 단계가 많아져 성능이 떨어질 수 밖에 없었다.
- 게임과 같은 고성능은 그래픽 엔진에 있어 예외적으로 유저 모드에서 시스템 콜을 직접 호출할 수 있게 하여 커널 단계를 생략하는 DirectX를 사용한다. 즉, DirectX는 입출력 성능을 극단적으로 끌어올릴 수 있는 인터페이스였다.
- 이후 출시된 윈도우 vista는 GDI 엔진을 제거하고 그래픽 엔진은 고성능이 아니더라도 모조리 DirectX로 대체했다.
- DirectX로 대체되면서 메모리를 단계마다 지속적으로 복사하는 게 아니라 한번에 복사하는 DMA(Direct Memory Access)가 나왔다. 이를 통해 메모리 관리에 대한 성능이 높아졌다.
